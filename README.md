# üöÄ FIAP : Challenge P√≥s-Tech Software Architecture
## üçî Projeto Fast Food | Arquitetura Limpa

Projeto realizado para a Fase 2 da P√≥s-Gradua√ß√£o de Arquitetura de Sistemas da FIAP. O sistema deste projeto foi constru√≠do utilizando Arquitetura Limpa como ensinado no m√≥dulo, para estudar este padr√£o de uso difundido no mercado.

### üë®‚Äçüè´ Grupo

Integrantes:
- Diego S. Silveira (RM352891)
- Giovanna H. B. Albuquerque (RM352679)
- Kelvin Vieira (RM352728)
- Wellington Vieira (RM352970)

### üìç DDD

Estudos de Domain Driven Design (DDD) como Domain StoryTelling, EventStorming, Linguagem Ub√≠qua foram feitos na ferramenta MIRO pelo grupo.
Os resultados destes estudos est√£o dispon√≠veis no link abaixo:

**üîó MIRO com DDD: https://miro.com/app/board/uXjVNMo8BCE=/?share_link_id=24975843522**

### üéØ Clean Architecture

Projeto feito com base no reposit√≥rio demonstrado em aula por Erick Muller.

**üîó Refer√™ncia: https://github.com/proferickmuller/fiap-cleanarch-na-pratica**


```
## Regras:

0. Fa√ßa **uma coisa de cada vez**.
1. Sempre comece pelo use case. Implemente o primeiro use case, implemente as entidades que ele usa, defina tudo o que ele precisa pra funcionar (via interfaces), e depois construa o controller para fazer o use case funcionar, e crie as interfaces necess√°rias. Depois disso, ajuste os Presenters e Gateways.
2. N√£o comece pela API ou pelo banco de dados. No m√°ximo tenha um desenho de api para comunicar com o mundo exterior, mas que pode ajudar na defini√ß√£o dos casos de uso. *O uso define o contexto, e n√£o o contr√°rio*.
3. Esque√ßa os frameworks nesse momento. foque nas tr√™s camadas internas.
4. Use interfaces para todos os lugares onde √© necess√°rio a inje√ß√£o de depend√™ncia.
5. Se quiser testar um caso de uso com gateway, use um "fornecedor de dados" falso (*mock*). Depois voc√™ pode implementar o acesso ao banco de dados.

## Heur√≠sticas

Pequenos passos te levam longe. Ciclos curtos e bem definidos.

Entenda e defina -> Construa -> Teste -> Disponibilize.
```

### üìê Desenho de Solu√ß√£o (Arquitetura)

Solu√ß√£o arquitet√¥nica realizada:

![](misc/fiap-fastfood-architecture-kubernetes-kubernetes.drawio.svg)

Solu√ß√£o arquitet√¥nica realizada (Cloud AWS):

![](misc/fiap-fastfood-architecture-kubernetes-eks.drawio.svg)


### üíª Tecnologias

Tecnologias utilizadas:

* Java 17
* Spring Framework
* Gradle
* MongoDB
* Docker
* Swagger
* Cloud AWS
* Kubernetes

### üëì Servi√ßos Utilizados

* Github
* Postman
* Docker Desktop 
* MongoDB Compass
* k9s
* Minikube
* AWS CLI


## üé¨ Como executar este projeto?

### 1) Rodando com Docker

### üíø Getting started - Rodando com docker-compose

Fa√ßa o download ou clone este projeto. √â preciso ter:

    - Docker instalado na m√°quina

üö® Passo-a-passo:

1. Abra o projeto no seu explorador de arquivos 
2. Migre para a pasta infra-docker e, no terminal, execute o comando: ```docker-compose up --build```
3. Um container com a aplica√ß√£o e um banco de dados MongoDB ser√£o inicializados nas portas 8080 e 27017 respectivamente
   1. Se possuir Docker Desktop, veja os containers rodando nele.
4. Para chamar os endpoints, voc√™ pode ver as rotas no link ```http://localhost:8080/swagger-ui/index.html```


### üíø Getting started - Rodando localmente com docker

Fa√ßa o download ou clone este projeto e abra em uma IDE (preferencialmente IntelliJ).
√â preciso ter:

    - Java 17
    - Docker instalado na m√°quina
    - plugin do Lombok na IDE

üö® Passo-a-passo:

1. Prepare sua IDE colocando o Java 17 nas configura√ß√µes do projeto
2. Importe um projeto como um projeto Gradle (bot√£o direito em ```src > build.gradle > import Gradle Project```)
3. Aguarde a instala√ß√£o das depend√™ncias
4. Migre para a pasta infra-docker e, no terminal, execute o comando: ```docker-compose -f docker-compose-local.yaml up```
5. Um container com um banco de dados MongoDB ser√° inicializado na porta 27017
6. Abra a classe FastFoodApplication e execute a aplica√ß√£o
7. Para chamar os endpoints, voc√™ pode ver as rotas no link ```http://localhost:8080/swagger-ui/index.html```

###
### 2) Rodando com Kubernetes

### üíø Getting started - Rodando em cluster kubernetes local

Fa√ßa o download ou clone este projeto e abra em uma IDE (preferencialmente IntelliJ).
√â preciso ter:

    - Docker instalado na m√°quina
    - Kubectl 
    - Minikube
    - (opcional) K9s

üö® Passo-a-passo:

1. Abra o Powershell
2. Inicie o minikube com o comando ```minikube start```
3. Com os tr√™s componentes acima instalados, configure o kubectl para usar o minikube com o comando ``` alias kubectl="minikube kubectl --"```
4. Voc√™ pode visualizar os pods rodando no minikube com o comando ```kubectl get pods```
5. Em outro terminal, navegue para a pasta infra-kubernetes deste projeto
6. Crie um namespace para conter os servi√ßos do projeto, por exemplo : ```kubectl create namespace fiap-pos-tech```
7. Altere o  "path" na linha 13 do arquivo "mongo-All.yaml" para um path da sua m√°quina, se necess√°rio
8. Execute primeiramente o comando ```kubectl apply -f mongo-All.yaml``` para subir os componentes do pod do Mongo
9. Execute o comando ```kubectl apply -f manifest.yaml``` para subir os componentes do pod da aplica√ß√£o
10. (opcional) Verifique os pods sendo executados atrav√©s do comando ```k9s``` no PowerShell
11. No PowerShell, execute o comando ```minikube tunnel``` para expor externamente a service criada para a aplica√ß√£o
12. Para chamar o swagger da aplica√ß√£o e ver os endpoints dispon√≠veis, acesse ```http://localhost:80/swagger-ui/index.html```
13. Caso queira remover os servi√ßos em execu√ß√£o, execute os seguintes comandos:
    ```
    kubectl delete service fastfood-fiap-deployment -n fiap-pos-tech
    kubectl delete service fastfood-fiap-service -n fiap-pos-tech
    kubectl delete deployment  fastfood-fiap-deployment -n fiap-pos-tech
    kubectl delete service mongodb-service -n fiap-pos-tech
    kubectl delete statefulset mongo-sfs -n fiap-pos-tech
    kubectl delete configmap mongodb-configmap -n fiap-pos-tech
    kubectl delete secret mongodb-secret -n fiap-pos-tech
    kubectl delete pvc mongodb-pvc -n fiap-pos-tech
    kubectl delete pv mongodb-pv
    ```


### üíø Getting started - Rodando em cluster EKS na Cloud AWS

Fa√ßa o download ou clone este projeto e abra em uma IDE (preferencialmente IntelliJ).
√â preciso ter:

    - Uma conta cadastrada na Cloud AWS
    - AWS CLI
    - Kubectl
    - (opcional) K9s

üö® Passo-a-passo:

1. Fa√ßa login na sua conta AWS 
2. Insira suas credenciais no AWS CLI atrav√©s do comando ```aws configure``` no terminal ou alterando no arquivo ```credentials``` na pasta C:/%userprofile%/.aws
3. Crie um cluster EKS com um Grupo de N√≥s associado a uma VPC
   1. NO CONSOLE: √â poss√≠vel criar a VPC, o Cluster e Grupo de N√≥s manualmente
   2. PROGRAMATICAMENTE: utilizando o arquivo aws-subnet-eks.yaml na pasta infra-kubernetes atrav√©s do comando ```eksctl create cluster -f aws-subnet-eks.yaml``` no terminal
      * ```Observa√ß√£o: o tamanho m√≠nimo das m√°quinas deve ser t3.medium```
4. Utilize o comando ```aws eks --region {nome-da-regiao}  update-kubeconfig --name {nome-do-cluster}``` para adicionar o cluster criado aos cluster autenticados
5. (opcional) Verifique a conex√£o com o cluster executando o comando ```k9s``` no terminal. O context e cluster estar√£o com o arn do cluster criado na AWS ("Context: arn:aws:eks:...")
6. (opcional) Caso deseje conferir informa√ß√µes sobre a rede do cluster, execute o comando ```aws eks describe-cluster --name cluster-teste-1 --region us-east-1 --query cluster.resourcesVpcConfig``` no terminal
7. Execute primeiramente o comando ```kubectl apply -f namespace.yaml``` para criar o namespace
8. Execute em seguida o comando ```kubectl apply -f mongo-All.yaml``` para subir os componentes do pod do Mongo
9. Execute o comando ```kubectl apply -f manifest.yaml``` para subir os componentes do pod da aplica√ß√£o
10. (opcional) Verifique os pods sendo executados atrav√©s do comando ```k9s``` no PowerShell
11. Ser√° criado um loadbalancer para a Service da aplica√ß√£o. Obtenha o DNS dele para realizar chamadas para a API. Ele possui o formato ````{sequencia-numerica}.{regiao}.elb.amazonaws.com````
12. Para chamar o swagger da aplica√ß√£o e ver os endpoints dispon√≠veis, acesse ```http://{DNS-Load-Balancer}/swagger-ui/index.html```
13. Caso queira remover os servi√ßos em execu√ß√£o, delete os servi√ßos na nuvem

### 3) Rodando com CICD e infra descentralizada

### üíø Getting started - Rodando em cluster kubernetes + Load balancer + Api Gateway na AWS

TBD

## Versioning

1.0.0.0
